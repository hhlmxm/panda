# 西电2019大二下学期项目设计

## 简介

项目总要求

1. 设计一个在公园内，可以和用户交互的机器人；
2. 项目开发周期，8周；
3. 硬件：
   * 上位机：smart4418; friendlyarm公司；Android开发；
   * stm32；MBED开发
   * FPGA: XILINX公司

4. 主要功能介绍：
   * 使用串口通信，和 STM32 进行数据交互。从距离传感器检测到有人靠近，到用户通过点击屏幕对系统发出指令，游戏过程中分数信息的实时传递等；
   * 通过插入模拟的用户卡片，上位机实现了累计用户成绩的功能；
   * 语音功能是项目的硬性要求；
   * 用户可以使用模拟的用户卡片进入游戏，也可以通过注册登录进入游戏。

5. 本仓库上传的是本次小组的上位机代码，JAVA开发。小组设计了一个掷骰子的游戏，用户和电脑比拼，点数之和先达到10点者胜。骰子由三种颜色构成，红，绿，蓝 分别代表1，3，5三种分数（这是因为颜色传感器，距离传感器，红外传感器是项目要求使用的硬性要求）。

6. 在 `Reference` 文件夹中包含了在这个过程中主要的参考资料和一部分设计思路，以备查阅

## 细节

1. 整体功能比较简单，系统的完整性较强。上位机主要是作为系统的进入点，但是主要的控制在stm32，由FPGA控制的机械臂是主要的机械结构；

2. 这次使用了比较简单的串口通信。上位机没有对于32发过来的数据进行校验，所以就会有丢数的情况发生。解决方案是让 32 发5次数据，这样成功率近似是100%。但是这样带来的问题是重复的数据有时会造成上位机对于数据的处理出现不稳定。本程序对此进行了处理，主要是设置一个 sign ，初始化为0。接受到数据+1；我们只对其为1的情况进行处理。

3. 中英文切换使用 `Locale` 方法没有实现成功。所以只能退而求其次。使用activity 的带值传递，和 `setText()` 方法。只能说凑合能说过去。

4. 由于使用了语音控制，语音是由本组同学录好的。本程序使用 `Mediaplayer` 方法控制录好的 mp3 文件。所以要仔细关注释放的节点，不然会出现重复播放。

5. 由于是向嵌入式开发板中烧录，需要使用签名授权，为了便于调试，可以使用 `adb install`，打开 logcat 进行调试；

## 总结

1. 整个上位机部分由自己开发，中间零零散散做出来了这样的作品。尽管不那么满意，但是第一次进行 android 开发，收获很多。
2. 整个项目不是一时间能做完的，很多东西都是一个一个事件节点。学校一直这是时间节点进行检查，对于督促项目的进展有很大的作用。
